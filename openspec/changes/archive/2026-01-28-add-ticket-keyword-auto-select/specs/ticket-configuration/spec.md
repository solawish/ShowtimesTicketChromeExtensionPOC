## ADDED Requirements

### Requirement: 票種關鍵詞與自動選票
系統 SHALL 在「時間」與「票種」選單之間提供「票種關鍵詞」輸入框與一組勾選框；選擇時間後仍先呼叫票種 API 並列出票種。當勾選框勾選時，忽視「票種 UI 必須已選擇」之限制；當使用者按下「訂票」且勾選時，先呼叫票種 API、依關鍵字 → 全票 → 單人套票 → 排除老人與愛心後取第一個之順序自動選出票種，再繼續後續訂票流程，並在勾選時於 UI 顯示說明文字。

#### Scenario: 顯示票種關鍵詞區塊
- **WHEN** 使用者開啟 popup 或已選擇時間
- **THEN** 在「時間」form-group 與「票種」form-group 之間顯示「票種關鍵詞」輸入框與勾選框（例如：啟用依關鍵詞自動選票）
- **AND** 輸入框與勾選框的狀態可被儲存與恢復（例如透過 Chrome Storage）

#### Scenario: 勾選時顯示說明
- **WHEN** 使用者勾選「依關鍵詞自動選票」勾選框
- **THEN** 在該區塊內或下方顯示說明文字，說明啟用後將在按下訂票時依關鍵字或預設優先順序（關鍵字 → 全票 → 單人套票 → 排除老人／愛心後取第一個）自動選擇票種後再繼續流程
- **AND** 當使用者取消勾選時，該說明文字隱藏或不再強調顯示

#### Scenario: 選擇時間後仍列出票種
- **WHEN** 使用者已選擇電影、場地並從時間下拉選單中選擇一個時間
- **THEN** 系統仍照常呼叫票種 API 並將票種填入票種下拉選單（與現有「選擇時間」行為一致）
- **AND** 票種選單顯示所有取得的票種供使用者參考，不因勾選框狀態而改變此列出行為

#### Scenario: 勾選時忽視票種必須選擇之限制
- **WHEN** 勾選框已勾選且「票種關鍵詞」輸入框有值（trim 後非空），且使用者已選擇電影、場地、時間
- **THEN** 系統不要求使用者必須在票種下拉選單中手動選擇票種
- **AND** 訂票按鈕在滿足其他條件（由實作定義）時可啟用，即允許在未手動選擇票種的情況下按下訂票

#### Scenario: 未勾選時維持既有訂票條件
- **WHEN** 勾選框未勾選，或「票種關鍵詞」輸入框為空（trim 後無字元）
- **THEN** 訂票按鈕之啟用條件與現有行為一致，即仍須在票種選單中手動選擇票種後始可訂票

#### Scenario: 訂票按下後先呼叫 API 再自動選票
- **WHEN** 使用者按下「訂票」按鈕且勾選框已勾選且「票種關鍵詞」有值（trim 後非空）
- **THEN** 系統先呼叫票種 API（`GET https://capi.showtimes.com.tw/1/ticketTypes/forEvent/{eventId}?...`，使用當前選定的 eventId）
- **AND** 取得票種列表後，依關鍵字 → 全票 → 單人套票 → 排除老人／愛心後取第一個之順序選出一個票種
- **AND** 若選出票種，則以該票種與當前數量繼續後續訂票流程（取得座位、鎖位等）；若無符合票種則不繼續流程並顯示適當錯誤或提示

#### Scenario: 自動選票邏輯關鍵字優先
- **WHEN** 訂票流程中執行自動選票且取得票種列表後
- **THEN** 系統先以「票種關鍵詞」搜尋票種名稱（ticketType.title）包含該關鍵字的票種
- **AND** 若有符合者，選取第一個符合的票種並以此繼續流程

#### Scenario: 自動選票 Fallback 全票
- **WHEN** 依關鍵字搜尋後無符合票種
- **THEN** 系統改為選取名稱（title）中含有「全票」的票種之第一個
- **AND** 若有符合者，以該票種繼續流程

#### Scenario: 自動選票 Fallback 單人套票
- **WHEN** 依關鍵字與「全票」皆無符合票種
- **THEN** 系統改為選取名稱（title）中含有「單人套票」的票種之第一個
- **AND** 若有符合者，以該票種繼續流程

#### Scenario: 自動選票 Fallback 排除老人與愛心後取第一個
- **WHEN** 依關鍵字、「全票」、「單人套票」皆無符合票種
- **THEN** 系統排除名稱（title）中含有「老人」或「愛心」的票種後，自剩餘票種中選取第一個
- **AND** 若有剩餘票種，以該第一個繼續流程；若無剩餘票種則不繼續流程並顯示適當錯誤或提示
